name: saml-sp-to-many-saml-idp

.left-column[
### What is it
### How is it used
SAML↔SAML
]

.right-column[

### SAML ↔ SAML (case A)

Connecting a single service provider to multiple identity providers.

<div class="mermaid">
graph LR
	sp[SP]
	ds[Discovery Service]
	idp1[IdP #1]
	idp2[IdP #2]
	proxy

	subgraph SATOSA
		proxy --- ds
	end

	sp ---|SAML| proxy
	proxy ---|SAML| idp1
	proxy ---|SAML| idp2
</div>

]

???

### Case

There are SAML2 service providers which are not able to handle multiple
identity providers. SATOSA can step in to solve this limitation, by being a
proxy to multiple identity providers utilizing a discovery service.

### Flow

1. The service provider sends a request to the proxy instance. The service
   provider only knows about the proxy and none of the actual identity
   providers.
1. The proxy redirects the user to the discovery service
1. The entity ID of the identity provider selected by the user is returned to
   the proxy
1. The proxy sent authentication request and when completed the the user get
   redirected back to the proxy
1. The response returned from the Identity provider is returned to the Service
   provider

---
name: many-saml-sp-to-saml-idp

.left-column[
### What is it
### How is it used
SAML↔SAML
]

.right-column[

### SAML ↔ SAML (case B)

Connecting many service providers to a single identity provider.

<div class="mermaid">
graph LR
	sp1[SP #1]
	sp2[SP #2]
	idp[IdP]
	proxy

	subgraph SATOSA
		proxy
	end

	sp1 ---|SAML| proxy
	sp2 ---|SAML| proxy
	proxy ---|SAML| idp
</div>

]

???

### Case

There are identity providers that cannot communicate with multiple service
providers, or, the attributes they release are incompatible to the ones the
service expects.

### Flow

1. Service provider sends request to proxy
1. Proxy communicates with the identity provider which normally can't talk to
   the service provider. A reason for this could be that it can't handle
   multiple entity ID's or that they are not really compatible.
1. Response returned by the identity provider containing the user information.
1. proxy returns the response to the service provider

---
name: saml-to-oidc

.left-column[
### What is it
### How is it used
SAML↔SAML

SAML↔OIDC
]

.right-column[

### SAML2 ↔ OpenID Connect and Social network logins

Connecting a SAML2 service provider to OpenID Connect providers.

<div class="mermaid">
graph LR
	sp[Service Provider]
	idp1[Google]
	idp2[Facebook]
	proxy

	subgraph SATOSA
		proxy
	end

	sp ---|SAML| proxy
	proxy ---|OIDC| idp1
	proxy ---|OIDC| idp2
</div>

]

???

SATOSA is able to act as a proxy between a SAML2 service provider and a OpenID
Connect provider (as is the case with most social network identity providers).

### Case

This setup makes it possible to connect a SAML2 service provider to multiple
social media identity providers such as Google and Facebook. The proxy makes it
possible to mirror a identity provider by generating SAML2 metadata
corresponding that provider and create dynamic endpoint which are connected to
a single identity provider. For more information about how to set up, configure
and run such a proxy instance please visit SAML2<->Social logins

### Flow

1. When the metadata generation script is executed it gathers the metadata from
   all the backend modules
1. The metadata generation script creates a new metadata file for every
   identity provider
1. The service provider needs to know which identity provider it want to
   authenticate at. How this is decided is out of scope for this application.
1. The SAML2 mirror front could handle the dynamic endpoint URL:s generated by
   the metadata generation script. Based on the URL the request is forwarded to
   the corresponding backend module
1. The backend communicates with the identity provider and receives user
   information
1. The response is converted to an internal representation and returned to the
   frontend module
1. The response is returned to the service provider

---
name: oidc-to-saml

.left-column[
### What is it
### How is it used
SAML↔SAML

SAML↔OIDC

OIDC↔SAML
]

.right-column[

### OpenID Connect ↔ SAML2

Connecting a OpenID Connect client to a SAML2 identity provider.

<div class="mermaid">
graph LR
	sp[OIDC client]
	idp[Identity Provider]
	proxy

	subgraph SATOSA
		proxy
	end

	sp ---|OIDC| proxy
	proxy ---|SAML| idp
</div>

]

???

SATOSA is able to act as a proxy between an OpenID Connect client and a SAML2
identity provider.

---
